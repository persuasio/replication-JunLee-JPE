-------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sokbaelee/Dropbox/Persuasion/JPE/Replication Files/scripts/logs/2022.11.12-10.42.35.log.txt
  log type:  text
 opened on:  12 Nov 2022, 10:42:35

. 
. di "Begin date and time: $S_DATE $S_TIME"
Begin date and time: 12 Nov 2022 10:42:35

. di "Stata version: `c(stata_version)'"
Stata version: 17

. di "Updated as of: `c(born_date)'"
Updated as of: 23 Aug 2022

. di "Variant:       `=cond( c(MP),"MP",cond(c(SE),"SE",c(flavor)) )'"
Variant:       MP

. di "Processors:    `c(processors)'"
Processors:    4

. di "OS:            `c(os)' `c(osdtl)'"
OS:            MacOSX 12.5.1

. di "Machine type:  `c(machine_type)'"
Machine type:  Mac (Apple Silicon)

. 
. * Stata version control
. version 16

. 
. * Create directories for output files
. cap mkdir "$Persuasion/results"

. 
. **********************
. * Run analysis
. **********************
. * TABLE 1. Persuasion Rates: Papers on Voter Turnout
. *do "$Persuasion/scripts/table1.do"
. 
. * Effects of Uncensored Media: Revisiting Chen and Yang (2019)
. *   To generate the dataset "ChenYang2019.dta", it is necessary to run CY19_data.do 
. *   after downloading the original dataset from 
. *   the AER webpage at https://www.aeaweb.org/articles?id=10.1257/aer.20171765
. *   and storing them at "$Persuasion/data/ChenYang2019".
. *   As the dataset is already created and stored at "$Persuasion/data/ChenYang2019", 
. *   the do file is commented below.
. *do "$Persuasion/scripts/CY19_data.do"
. *   TABLE 2. Persuasion Rates of Exposure to Uncensored Internet
. *do "$Persuasion/scripts/table2.do"
. 
. * Effects of Political News: Revisting Gerber, Karlan, and Bergan (2009) 
. *   TABLE 3. Summary Statistics of the GKB Data
. *do "$Persuasion/scripts/table3.do"
. *   TABLE 4. Estimates of the Key Parameters
. *do "$Persuasion/scripts/table4.do"
. 
. *       TABLE D1. Persuasion Rates: Fox News Effects
. *do "$Persuasion/scripts/tableD1.do"
. 
. *       FIGURE D1. Estimates of Marginal and Average Persuasion Rates
. *do "$Persuasion/scripts/tableD2.do"
. 
. *       TABLE E1. Persuasive Effect by Treatment in Landry et al. (2006)
. *do "$Persuasion/scripts/tableE1.do"
. *       TABLE E2. Persuasive Effect by Treatment in DLM
. *do "$Persuasion/scripts/tableE2.do"
. 
. *       TABLE H1. Persuasion Rates: NTV Effects Using a Binary Instrument
. do "$Persuasion/scripts/tableH1.do"

. ************
. * SCRIPT:   tableH1.do
. * PURPOSE:  Creates Table H1
. *
. * ACKNOWLEDGMENT
. *       The orginal dataset "NTV_Individual_Data.dta" is from Enikolopov, Petrova, and Zhuravskaya (AER, 2011).
. ************
. 
. use "$Persuasion/data/EnikolopovPetrovaZhuravskaya2011/NTV_Individual_Data.dta", clear

. 
. local basic = "logpop98 wage98_ln"

. local sociodem = "male age educ1 married consump"

. 
. local party_list = "Unity OVR"

. 
. *** create outcome variables based on directional treatment ***
. 
. gen y_vote_Unity = 0

. replace y_vote_Unity = 1 if vote_Unity == 0   
(993 real changes made)

. 
. gen y_vote_OVR = 0

. replace y_vote_OVR = 1 if vote_OVR == 1   
(166 real changes made)

. 
. *** create a binary instrument ***
. 
. svyset [pweight=kishweig]

Sampling weights: kishweig
             VCE: linearized
     Single unit: missing
        Strata 1: <one>
 Sampling unit 1: <observations>
           FPC 1: <zero>

. 
. _pctile tvmaxtveloss5050powerA [pweight=kishweig], p(50)         

. scalar IV_p50 = r(r1)    

. 
.         gen IV_NTV = 0

. replace IV_NTV = 1 if tvmaxtveloss5050powerA > IV_p50
(1,714 real changes made)

. 
. *** predict Z ***
. 
. qui probit  IV_NTV `sociodem' `basic' [pweight=kishweig]  

. predict phat_Z1
(option pr assumed; Pr(IV_NTV))
(4,658 missing values generated)

. 
. *** predict T given Z=1 and Z=0 ***
. 
. qui probit  Watches_NTV_1999 `sociodem' `basic' [pweight=kishweig] if IV_NTV==1 

. predict phat_T_Z1
(option pr assumed; Pr(Watches_NTV_1999))
(4,658 missing values generated)

. 
. qui probit  Watches_NTV_1999 `sociodem' `basic' [pweight=kishweig] if IV_NTV==0 

. predict phat_T_Z0
(option pr assumed; Pr(Watches_NTV_1999))
(4,658 missing values generated)

. 
. *** input for ATE estimation ***
. 
. foreach party in  `party_list'    {
  2. 
. gen newvote_`party' = 0
  3. replace newvote_`party' = 1 if y_vote_`party' == 1  
  4. 
. *** predict Y given Z=1 and Z=0 ***
. 
. qui probit newvote_`party' `sociodem' `basic' [pweight=kishweig] if IV_NTV==1 
  5. predict phat_Y_Z1_`party'
  6. 
. qui probit newvote_`party' `sociodem' `basic' [pweight=kishweig] if IV_NTV==0 
  7. predict phat_Y_Z0_`party'
  8. 
. *** compute relevant quantities ***
. 
. gen      w1_`party' = IV_NTV/phat_Z1
  9. gen      w0_`party' = (1-IV_NTV)/(1-phat_Z1)
 10. gen      t1_`party' = w1_`party'*(newvote_`party'-phat_Y_Z1_`party')/phat_Y_Z1_`party' 
 11. gen      t0_`party' = w0_`party'*(newvote_`party'-phat_Y_Z0_`party')/phat_Y_Z0_`party'
 12. 
. *** average out with respect to covariates ***
. 
. svyset [pweight=kishweig]
 13. 
. svy: mean phat_Y_Z1_`party'
 14. scalar beta1 = e(b) 
 15. 
. svy: mean phat_Y_Z0_`party'
 16. scalar beta0 = e(b) 
 17. 
. *** compute the lower bound on the average persuasion rate ***
. 
. scalar ate_lb = (beta1 - beta0)/(1-beta0)       
 18. 
. matrix results_`party' = J(3,1,0)
 19. matrix results_`party'[1,1] = ate_lb
 20. 
. *** compute the standard errors ***
. 
. gen infl_t1_`party' = t1_`party' + (phat_Y_Z1_`party' - beta1)
 21. gen infl_t0_`party' = t0_`party' + (phat_Y_Z0_`party' - beta0)
 22. gen infl_`party' = (1/(1-beta0))*(infl_t1_`party' - ((1-beta1)/(1-beta0))*infl_t0_`party')
 23. 
. svy: mean new_infl_`party'
 24. matrix result_se = e(V)
 25. matrix results_`party'[2,1] = sqrt(result_se[1,1])                               
 26. matrix results_`party'[3,1] = results_`party'[1,1]-1.645*results_`party'[2,1]   
 27. 
. }
(993 real changes made)
(option pr assumed; Pr(newvote_Unity))
(4,658 missing values generated)
(option pr assumed; Pr(newvote_Unity))
(4,658 missing values generated)
(4,658 missing values generated)
(4,658 missing values generated)
(4,658 missing values generated)
(4,658 missing values generated)

Sampling weights: kishweig
             VCE: linearized
     Single unit: missing
        Strata 1: <one>
 Sampling unit 1: <observations>
           FPC 1: <zero>
(running mean on estimation sample)

Survey: Mean estimation

Number of strata =     1             Number of obs   =      1,300
Number of PSUs   = 1,300             Population size = 1,312.0491
                                     Design df       =      1,299

-----------------------------------------------------------------
                |             Linearized
                |       Mean   std. err.     [95% conf. interval]
----------------+------------------------------------------------
phat_Y_Z1_Unity |    .595566   .0035143      .5886716    .6024604
-----------------------------------------------------------------
type mismatch
r(109);

end of do-file
r(109);

end of do-file

r(109);

. do "/Users/sokbaelee/Dropbox/Persuasion/JPE/Replication Files/run.do"

. **********************
. * OVERVIEW
. *   This script generates selected tables for the paper:
. *       "IDENTIFYING THE EFFECT OF PERSUASION" (Sung Jae Jun and Sokbae Lee)
. *   All data are stored in /data
. *   All tables are outputted to /results
. * 
. * SOFTWARE REQUIREMENTS
. *   Stata version 17 or newer
. *
. * PACKAGE REQUIREMENTS
. *   persuasio (can be installed by ssc install persuasio, replace)
. *   outreg (can be installed by ssc install outreg, replace)
. *
. * TO PERFORM A CLEAN RUN, DELETE THE FOLLOWING FOLDER:
. *   $Persuasion/results
. *
. * ACKNOWLEDGMENT
. *       The structure of the replication files is forked from 
. *   Illinois Workplace Wellness Study: Public Use Data Repository
. *   at https://github.com/reifjulian/illinois-wellness-data
. **********************
. 
. **********************
. * Parameters defined by user
. **********************
. 
. * "Persuasion" points to the root directory, which contains the subfolders "data" and "scripts"
. global Persuasion "/Users/sokbaelee/Dropbox/Persuasion/JPE/Replication Files"

. 
. * Number of bootstraps for Table 2
. * The published paper used nbt = 10000. Runtime is approximately 3 hours on an iMac (M1, 2021).
. * Use nbt = 10 to check whether replication code runs without an error. 
. global nbt = 10000

. 
. * set seed for replicability 
. set seed 987975 

. 
. **********************
. **********************
. 
. * Confirm that the global for the root directory has been defined
. assert !missing("$Persuasion")

. 
. * Initialize log and record system parameters
. clear 

. set more off

. cap mkdir "$Persuasion/scripts/logs"

. cap log close
