-------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sokbaelee/Dropbox/Persuasion/JPE/Replication Files/scripts/logs/2022.11.11-08.08.47.log.txt
  log type:  text
 opened on:  11 Nov 2022, 08:08:47

. 
. di "Begin date and time: $S_DATE $S_TIME"
Begin date and time: 11 Nov 2022 08:08:47

. di "Stata version: `c(stata_version)'"
Stata version: 17

. di "Updated as of: `c(born_date)'"
Updated as of: 23 Aug 2022

. di "Variant:       `=cond( c(MP),"MP",cond(c(SE),"SE",c(flavor)) )'"
Variant:       MP

. di "Processors:    `c(processors)'"
Processors:    4

. di "OS:            `c(os)' `c(osdtl)'"
OS:            MacOSX 12.5.1

. di "Machine type:  `c(machine_type)'"
Machine type:  Mac (Apple Silicon)

. 
. * Stata version control
. version 16

. 
. * Create directories for output files
. cap mkdir "$Persuasion/results"

. 
. **********************
. * Run analysis
. **********************
. * TABLE 1. Persuasion Rates: Papers on Voter Turnout
. *do "$Persuasion/scripts/table1.do"
. 
. * Effects of Uncensored Media: Revisiting Chen and Yang (2019)
. *   To generate the dataset "ChenYang2019.dta", it is necessary to run CY19_data.do 
. *   after downloading the original dataset from 
. *   the AER webpage at https://www.aeaweb.org/articles?id=10.1257/aer.20171765
. *   and storing them at "$Persuasion/data/ChenYang2019".
. *   As the dataset is already created and stored at "$Persuasion/data/ChenYang2019", 
. *   the do file is commented below.
. *do "$Persuasion/scripts/CY19_data.do"
. *   TABLE 2. Persuasion Rates of Exposure to Uncensored Internet
. *do "$Persuasion/scripts/table2.do"
. 
. * Effects of Political News: Revisting Gerber, Karlan, and Bergan (2009) 
. *   TABLE 3. Summary Statistics of the GKB Data
. *do "$Persuasion/scripts/table3.do"
. *   TABLE 4. Estimates of the Key Parameters
. *do "$Persuasion/scripts/table4.do"
. 
. *       TABLE D1. Persuasion Rates: Fox News Effects
. *do "$Persuasion/scripts/tableD1.do"
. 
. *       FIGURE D1. Estimates of Marginal and Average Persuasion Rates
. do "$Persuasion/scripts/figureD1.do"

. ************
. * SCRIPT:   figureD1.do
. * PURPOSE:  Creates Figure D1
. *
. * ACKNOWLEDGMENT
. *       The orginal dataset "NTV_Individual_Data.dta" is from Enikolopov, Petrova, and Zhuravskaya (AER, 2011).
. ************
. 
. use "$Persuasion/data/EnikolopovPetrovaZhuravskaya2011/NTV_Individual_Data.dta", clear

. 
. local basic = "logpop98 wage98_ln"

. local sociodem = "male age educ1 married consump"

. 
. local party_list = "Unity OVR"

. 
. *** create outcome variables based on directional treatment ***
. 
. gen y_vote_Unity = 0

. replace y_vote_Unity = 1 if vote_Unity == 0   
(993 real changes made)

. 
. gen y_vote_OVR = 0

. replace y_vote_OVR = 1 if vote_OVR == 1   
(166 real changes made)

. 
. *** predict the exposure rate, that is, e(X,Z) = P(T=1|X,Z) ***
. *** specification: linear in Z and X ***
. 
. probit  Watches_NTV_1999 tvmaxtveloss5050powerA `sociodem' `basic' [pweight=kishweig]

Iteration 0:   log pseudolikelihood = -809.06705  
Iteration 1:   log pseudolikelihood = -741.86673  
Iteration 2:   log pseudolikelihood =  -741.6003  
Iteration 3:   log pseudolikelihood = -741.60028  

Probit regression                                       Number of obs =  1,185
                                                        Wald chi2(8)  = 105.94
                                                        Prob > chi2   = 0.0000
Log pseudolikelihood = -741.60028                       Pseudo R2     = 0.0834

----------------------------------------------------------------------------------------
                       |               Robust
      Watches_NTV_1999 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-----------------------+----------------------------------------------------------------
tvmaxtveloss5050powerA |   .0068679   .0011649     5.90   0.000     .0045848    .0091511
                  male |   .2299747   .0893844     2.57   0.010     .0547845    .4051648
                   age |  -.0063456   .0029081    -2.18   0.029    -.0120454   -.0006458
                 educ1 |   .2459444   .1188836     2.07   0.039     .0129369    .4789519
               married |   .0520022   .0908934     0.57   0.567    -.1261455    .2301499
               consump |   .0711412   .0341425     2.08   0.037     .0042231    .1380594
              logpop98 |  -.2162026    .045017    -4.80   0.000    -.3044343    -.127971
             wage98_ln |   .4838216   .1418335     3.41   0.001     .2058331    .7618101
                 _cons |  -2.154867   .9164043    -2.35   0.019    -3.950986   -.3587474
----------------------------------------------------------------------------------------

. predict phat
(option pr assumed; Pr(Watches_NTV_1999))
(4,658 missing values generated)

. 
. ***
. 
. foreach party in `party_list' {
  2. 
.         * generate Y*(1-T)
.     gen notwatch_vote_`party' = 0
  3.         replace notwatch_vote_`party' = 1 if y_vote_`party' == 1 & Watches_NTV_1999==0
  4.         
.         * linear probability model of Y given X and e(X,Z)
.         * specification: linear in X and cubic in e(X,Z), while interacting some of X and e(X,Z)
.         reg y_vote_`party' `sociodem' `basic' ///
>                         c.phat c.phat#c.phat c.phat#c.phat#c.phat ///
>                         c.phat#i.male c.phat#c.age c.phat#i.educ1 c.phat#i.married c.phat#c.consump ///
>                         [pweight=kishweig]
  5.         
.         margins [pweight=kishweig], dydx(phat) at(phat = 0.01(0.01)0.99)
  6. 
. }
(313 real changes made)
(sum of wgt is 1,312.04910933971)

Linear regression                               Number of obs     =      1,300
                                                F(15, 1284)       =       4.23
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0511
                                                Root MSE          =      .4882

--------------------------------------------------------------------------------------
                     |               Robust
        y_vote_Unity | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------------+----------------------------------------------------------------
                male |   .1476635   .1403743     1.05   0.293    -.1277246    .4230516
                 age |   .0097242   .0041921     2.32   0.021     .0015001    .0179483
               educ1 |   .0741608      .1628     0.46   0.649    -.2452224     .393544
             married |   .0404414   .1280636     0.32   0.752    -.2107953    .2916782
             consump |  -.0573286   .0551864    -1.04   0.299     -.165594    .0509367
            logpop98 |   .0070906   .0160963     0.44   0.660    -.0244874    .0386686
           wage98_ln |  -.1845544   .0687819    -2.68   0.007    -.3194917   -.0496171
                phat |   .9654167   2.375671     0.41   0.685    -3.695206    5.626039
                     |
       c.phat#c.phat |  -1.435164   4.236805    -0.34   0.735    -9.746985    6.876657
                     |
c.phat#c.phat#c.phat |   1.285474   2.421765     0.53   0.596    -3.465577    6.036524
                     |
         male#c.phat |
                  1  |   -.282562   .2180701    -1.30   0.195    -.7103749    .1452509
                     |
        c.phat#c.age |  -.0040113   .0068059    -0.59   0.556    -.0173633    .0093406
                     |
        educ1#c.phat |
                  1  |  -.0275575   .2982328    -0.09   0.926    -.6126345    .5575195
                     |
      married#c.phat |
                  1  |  -.0101435   .2089699    -0.05   0.961    -.4201034    .3998165
                     |
    c.phat#c.consump |   .0738618   .0804907     0.92   0.359    -.0840459    .2317696
                     |
               _cons |   1.129342   .5571958     2.03   0.043     .0362275    2.222456
--------------------------------------------------------------------------------------
(0.01) invalid statistic
r(198);

end of do-file
r(198);

end of do-file

r(198);

. do "/Users/sokbaelee/Dropbox/Persuasion/JPE/Replication Files/run.do"

. **********************
. * OVERVIEW
. *   This script generates selected tables for the paper:
. *       "IDENTIFYING THE EFFECT OF PERSUASION" (Sung Jae Jun and Sokbae Lee)
. *   All data are stored in /data
. *   All tables are outputted to /results
. * 
. * SOFTWARE REQUIREMENTS
. *   Stata version 17 or newer
. *
. * PACKAGE REQUIREMENTS
. *   persuasio (can be installed by ssc install persuasio, replace)
. *   outreg (can be installed by ssc install outreg, replace)
. *
. * TO PERFORM A CLEAN RUN, DELETE THE FOLLOWING FOLDER:
. *   $Persuasion/results
. *
. * ACKNOWLEDGMENT
. *       The structure of the replication files is forked from 
. *   Illinois Workplace Wellness Study: Public Use Data Repository
. *   at https://github.com/reifjulian/illinois-wellness-data
. **********************
. 
. **********************
. * Parameters defined by user
. **********************
. 
. * "Persuasion" points to the root directory, which contains the subfolders "data" and "scripts"
. global Persuasion "/Users/sokbaelee/Dropbox/Persuasion/JPE/Replication Files"

. 
. * Number of bootstraps for Table 2
. * The published paper used nbt = 10000. Runtime is approximately 3 hours on an iMac (M1, 2021).
. * Use nbt = 10 to check whether replication code runs without an error. 
. global nbt = 10000

. 
. * set seed for replicability 
. set seed 987975 

. 
. **********************
. **********************
. 
. * Confirm that the global for the root directory has been defined
. assert !missing("$Persuasion")

. 
. * Initialize log and record system parameters
. clear 

. set more off

. cap mkdir "$Persuasion/scripts/logs"

. cap log close
